env:
  contexts:
    - name: Authentication Test
      urls:
        - ${Z_URL}
      includePaths:
        - ${Z_URL_REGEX}.*
      excludePaths:
        # Don't scan every Jenkins job, just the static link ones
        # These pages are all the same and are not useful to scan more than once
        - "^${Z_URL_REGEX}\\/job\\/[^\\/]+\\/[0-9]+(?:\\/.*)?$"
        # Don't scan the Jenkins artifacts
        - "^${Z_URL_REGEX}\\/job\\/[^\\/]+\\/[^\\/]+\\/artifacts\\/.*$"
        # Don't scan /static/*
        - "^${Z_URL_REGEX}\\/static\\/.*$"
      authentication:
        method: browser
        parameters:
          loginPageUrl: ${Z_URL}
          browserId: firefox-headless
          loginPageWait: 10
          steps:
            - description: auto
              type: AUTO_STEPS
              timeout: 1000
        verification:
          method: poll
          loggedInRegex: \Q 200 OK\E
          loggedOutRegex: \Q 403 Forbidden\E
          pollFrequency: 60
          pollUnits: requests
          pollUrl: ${Z_URL}/i18n/resourceBundle?baseName=jenkins.dialogs&_=1747303641693
          pollPostData: ""
      sessionManagement:
        method: headers
      technology: {}
      structure: {}
      users:
        - name: env-user
          credentials:
            password: ${Z_KEYCLOAK_PASS}
            username: ${Z_KEYCLOAK_USER}
  parameters: {}
options:
  config:
    - name: view.mode
      value: SAFE
jobs:
  - type: spider
    parameters:
      context: Authentication Test
      user: env-user
      parseDsStore: null
  - type: spiderAjax
    parameters:
      context: Authentication Test
      user: env-user
      browserId: firefox-headless
  - type: passiveScan-wait
    parameters:
      maxDuration: 1200
  - type: report
    parameters:
      template: traditional-json
      reportDir: "."
      reportTitle: "ZAP Report"
      reportDescription: "ZAP Report"
  - type: report
    parameters:
      template: traditional-pdf
      reportDir: "."
      reportTitle: "ZAP Report"
      reportDescription: "ZAP Report"
